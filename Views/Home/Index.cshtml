@model u22710362_HW03.Models.HomeViewModel

@{
    ViewBag.Title = "Home - Bike Store Management";
}

<style>
    .section-container {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .section-box {
        flex: 1;
        border: 2px solid #ccc;
        padding: 15px;
        background-color: #f9f9f9;
    }

        .section-box h4 {
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }

    .form-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
    }

        .form-row label {
            flex: 0 0 100px;
            margin: 0;
        }

        .form-row input,
        .form-row select {
            flex: 1;
        }

    .list-box {
        border: 1px solid #999;
        padding: 10px;
        min-height: 150px;
        background-color: white;
        margin-top: 10px;
    }

        .list-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .list-box li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

    .pagination {
        display: flex;
        gap: 5px;
        margin-top: 10px;
        justify-content: flex-start;
    }

        .pagination button {
            padding: 5px 10px;
            border: 1px solid #999;
            background-color: white;
            cursor: pointer;
        }

            .pagination button.active {
                background-color: #007bff;
                color: white;
            }

    .btn-create {
        margin-top: 10px;
        padding: 8px 15px;
    }

    .product-details {
        display: flex;
        gap: 20px;
    }

    .product-form {
        flex: 1;
    }

    .product-image {
        flex: 0 0 200px;
        border: 1px solid #999;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: white;
    }

    .filter-row {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }

        .filter-row select {
            flex: 1;
        }
</style>

<div class="container-fluid mt-4">
    <!-- Top Navigation Tabs -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
            <a class="nav-link active" href="@Url.Action("Index", "Home")">Staff</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Customers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Products</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="@Url.Action("Index", "Maintain")">Maintain</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="@Url.Action("Index", "Report")">Reports</a>
        </li>
    </ul>

    <div class="section-container">
        <!-- Staff Section -->
        <div class="section-box">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h4>Staff</h4>
                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#createStaffModal">Create</button>
            </div>

            <div class="form-row">
                <label>First Name</label>
                <input type="text" class="form-control form-control-sm" id="staff_first_name">
            </div>
            <div class="form-row">
                <label>Last Name</label>
                <input type="text" class="form-control form-control-sm" id="staff_last_name">
            </div>
            <div class="form-row">
                <label>Staff id</label>
                <input type="text" class="form-control form-control-sm" id="staff_id" readonly>
            </div>
            <div class="form-row">
                <label>Email</label>
                <input type="text" class="form-control form-control-sm" id="staff_email" readonly>
            </div>

            <div class="list-box">
                <ul id="staffList">
                    @foreach (var staff in Model.Staffs.Take(5))
                    {
                        <li>@staff.first_name @staff.last_name - @staff.stores.store_name</li>
                    }
                </ul>
            </div>

            <div class="pagination">
                <button class="active">1</button>
                <button>2</button>
                <button>3</button>
                <button>4</button>
                <button>...</button>
                <button>&gt;</button>
                <button>&lt;</button>
                <button>&gt;&gt;</button>
            </div>
        </div>

        <!-- Customers Section -->
        <div class="section-box">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h4>Customers</h4>
                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#createCustomerModal">Create</button>
            </div>

            <div class="form-row">
                <label>First Name</label>
                <input type="text" class="form-control form-control-sm" id="customer_first_name">
            </div>
            <div class="form-row">
                <label>Last Name</label>
                <input type="text" class="form-control form-control-sm" id="customer_last_name">
            </div>
            <div class="form-row">
                <label>Customer id</label>
                <input type="text" class="form-control form-control-sm" id="customer_id" readonly>
            </div>
            <div class="form-row">
                <label>Email</label>
                <input type="text" class="form-control form-control-sm" id="customer_email" readonly>
            </div>

            <div class="list-box">
                <ul id="customerList">
                    @foreach (var customer in Model.Customers.Take(5))
                    {
                        <li>@customer.first_name @customer.last_name - @customer.city</li>
                    }
                </ul>
            </div>

            <div class="pagination">
                <button class="active">1</button>
                <button>2</button>
                <button>3</button>
                <button>4</button>
                <button>...</button>
                <button>&gt;</button>
                <button>&lt;</button>
                <button>&gt;&gt;</button>
            </div>
        </div>

        <!-- Products Section -->
        <div class="section-box">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h4>Products</h4>
                <div>
                    <select class="form-select form-select-sm d-inline-block" style="width: auto; margin-right: 10px;" id="brandFilter">
                        <option value="">All Brands</option>
                        @foreach (var brand in ViewBag.Brands)
                        {
                            <option value="@brand.brand_id">@brand.brand_name</option>
                        }
                    </select>
                    <button type="button" class="btn btn-sm btn-secondary" id="filterBtn">Filter</button>
                </div>
            </div>

            <div class="product-details">
                <div class="product-form">
                    <div class="form-row">
                        <label>Product Name</label>
                        <input type="text" class="form-control form-control-sm" id="product_name" readonly>
                    </div>
                    <div class="form-row">
                        <label>Model Year</label>
                        <input type="text" class="form-control form-control-sm" id="product_year" readonly>
                    </div>
                    <div class="form-row">
                        <label>Price</label>
                        <input type="text" class="form-control form-control-sm" id="product_price" readonly>
                    </div>
                </div>
                <div class="product-image">
                    <span>Bicycle image</span>
                </div>
            </div>

            <div class="list-box" style="margin-top: 10px;">
                <ul id="productList">
                    @foreach (var product in Model.Products.Take(5))
                    {
                        <li>@product.product_name - $@product.list_price</li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Create Staff Modal -->
<div class="modal fade" id="createStaffModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Staff</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="createStaffForm">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">First Name *</label>
                        <input type="text" class="form-control" name="first_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Last Name *</label>
                        <input type="text" class="form-control" name="last_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" class="form-control" name="phone">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Active *</label>
                        <select class="form-select" name="active" required>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Store *</label>
                        <select class="form-select" name="store_id" required>
                            <option value="">Select Store</option>
                            @foreach (var store in ViewBag.Stores)
                            {
                                <option value="@store.store_id">@store.store_name</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Manager (Optional)</label>
                        <select class="form-select" name="manager_id">
                            <option value="">No Manager</option>
                            @foreach (var staff in Model.Staffs)
                            {
                                <option value="@staff.staff_id">@staff.first_name @staff.last_name</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Staff</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Customer Modal -->
<div class="modal fade" id="createCustomerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Customer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="createCustomerForm">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">First Name *</label>
                        <input type="text" class="form-control" name="first_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Last Name *</label>
                        <input type="text" class="form-control" name="last_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" class="form-control" name="phone">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Street</label>
                        <input type="text" class="form-control" name="street">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" name="city">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">State</label>
                        <input type="text" class="form-control" name="state">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Zip Code</label>
                        <input type="text" class="form-control" name="zip_code" maxlength="5">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-success">Save Customer</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Create Staff Form Submit
            $('#createStaffForm').submit(function (e) {
                e.preventDefault();
                var submitBtn = $(this).find('button[type="submit"]');
                submitBtn.prop('disabled', true).text('Saving...');

                $.ajax({
                    url: '@Url.Action("CreateStaff", "Home")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        if (response.success) {
                            alert(response.message || 'Staff created successfully!');
                            $('#createStaffModal').modal('hide');
                            location.reload();
                        } else {
                            alert(response.message || 'Failed to create staff.');
                            submitBtn.prop('disabled', false).text('Save Staff');
                        }
                    },
                    error: function(xhr) {
                        alert('An error occurred: ' + (xhr.responseText || 'Unknown error'));
                        submitBtn.prop('disabled', false).text('Save Staff');
                    }
                });
            });

            // Create Customer Form Submit
            $('#createCustomerForm').submit(function (e) {
                e.preventDefault();
                var submitBtn = $(this).find('button[type="submit"]');
                submitBtn.prop('disabled', true).text('Saving...');

                $.ajax({
                    url: '@Url.Action("CreateCustomer", "Home")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        if (response.success) {
                            alert(response.message || 'Customer created successfully!');
                            $('#createCustomerModal').modal('hide');
                            location.reload();
                        } else {
                            alert(response.message || 'Failed to create customer.');
                            submitBtn.prop('disabled', false).text('Save Customer');
                        }
                    },
                    error: function(xhr) {
                        alert('An error occurred: ' + (xhr.responseText || 'Unknown error'));
                        submitBtn.prop('disabled', false).text('Save Customer');
                    }
                });
            });

            // Filter Products
            $('#filterBtn').click(function () {
                var brandId = $('#brandFilter').val();

                $.ajax({
                    url: '@Url.Action("FilterProducts", "Home")',
                    type: 'GET',
                    data: { brandId: brandId },
                    success: function (data) {
                        if (data && data.length > 0) {
                            var html = '';
                            data.forEach(function(product) {
                                html += '<li>' + product.product_name + ' - $' + product.list_price + '</li>';
                            });
                            $('#productList').html(html);
                        } else {
                            $('#productList').html('<li>No products found</li>');
                        }
                    },
                    error: function() {
                        alert('Failed to filter products');
                    }
                });
            });
        });
    </script>
}