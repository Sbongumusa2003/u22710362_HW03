@model u22710362_HW03.Models.HomeViewModel

@{
    ViewBag.Title = "Maintain - Bike Store Management";
}

<div class="container mt-4">
    <h1 class="text-center mb-4">Maintain Records</h1>

    <!-- Staff Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Staff Members</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Store</th>
                                    <th>Active</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var staff in Model.Staffs)
                                {
                                    <tr>
                                        <td>@staff.first_name @staff.last_name</td>
                                        <td>@staff.email</td>
                                        <td>@staff.phone</td>
                                        <td>@staff.stores?.store_name</td>
                                        <td>@(staff.active == 1 ? "Yes" : "No")</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning edit-staff" data-id="@staff.staff_id">Edit</button>
                                            <button class="btn btn-sm btn-info details-staff" data-id="@staff.staff_id">Details</button>
                                            <button class="btn btn-sm btn-danger delete-staff" data-id="@staff.staff_id">Delete</button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customers Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0">Customers</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>City</th>
                                    <th>State</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var customer in Model.Customers)
                                {
                                    <tr>
                                        <td>@customer.first_name @customer.last_name</td>
                                        <td>@customer.email</td>
                                        <td>@customer.phone</td>
                                        <td>@customer.city</td>
                                        <td>@customer.state</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning edit-customer" data-id="@customer.customer_id">Edit</button>
                                            <button class="btn btn-sm btn-info details-customer" data-id="@customer.customer_id">Details</button>
                                            <button class="btn btn-sm btn-danger delete-customer" data-id="@customer.customer_id">Delete</button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Products Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h3 class="mb-0">Products (Bicycles)</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Product Name</th>
                                    <th>Brand</th>
                                    <th>Category</th>
                                    <th>Model Year</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var product in Model.Products)
                                {
                                    <tr>
                                        <td>@product.product_name</td>
                                        <td>@product.brands?.brand_name</td>
                                        <td>@product.categories?.category_name</td>
                                        <td>@product.model_year</td>
                                        <td>$@product.list_price</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning edit-product" data-id="@product.product_id">Edit</button>
                                            <button class="btn btn-sm btn-info details-product" data-id="@product.product_id">Details</button>
                                            <button class="btn btn-sm btn-danger delete-product" data-id="@product.product_id">Delete</button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Staff Modal -->
<div class="modal fade" id="editStaffModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Staff</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editStaffForm">
                @Html.AntiForgeryToken()
                <input type="hidden" id="edit_staff_id" name="staff_id">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">First Name</label>
                        <input type="text" class="form-control" id="edit_staff_first_name" name="first_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="edit_staff_last_name" name="last_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="edit_staff_email" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" class="form-control" id="edit_staff_phone" name="phone">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Active</label>
                        <select class="form-select" id="edit_staff_active" name="active" required>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Store</label>
                        <select class="form-select" id="edit_staff_store_id" name="store_id" required>
                            @foreach (var store in ViewBag.Stores)
                            {
                                <option value="@store.store_id">@store.store_name</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Manager</label>
                        <select class="form-select" id="edit_staff_manager_id" name="manager_id">
                            <option value="">None</option>
                            @foreach (var manager in ViewBag.Managers)
                            {
                                <option value="@manager.staff_id">@manager.first_name @manager.last_name</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Details Staff Modal -->
<div class="modal fade" id="detailsStaffModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Staff Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="staffDetailsContent"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Customer Modal -->
<div class="modal fade" id="editCustomerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Customer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editCustomerForm">
                @Html.AntiForgeryToken()
                <input type="hidden" id="edit_customer_id" name="customer_id">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">First Name</label>
                        <input type="text" class="form-control" id="edit_customer_first_name" name="first_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="edit_customer_last_name" name="last_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="edit_customer_email" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" class="form-control" id="edit_customer_phone" name="phone">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Street</label>
                        <input type="text" class="form-control" id="edit_customer_street" name="street">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" id="edit_customer_city" name="city">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">State</label>
                        <input type="text" class="form-control" id="edit_customer_state" name="state">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Zip Code</label>
                        <input type="text" class="form-control" id="edit_customer_zip_code" name="zip_code">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Details Customer Modal -->
<div class="modal fade" id="detailsCustomerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Customer Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="customerDetailsContent"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editProductForm">
                @Html.AntiForgeryToken()
                <input type="hidden" id="edit_product_id" name="product_id">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Product Name</label>
                        <input type="text" class="form-control" id="edit_product_name" name="product_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Brand</label>
                        <select class="form-select" id="edit_product_brand_id" name="brand_id" required>
                            @foreach (var brand in ViewBag.Brands)
                            {
                                <option value="@brand.brand_id">@brand.brand_name</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="edit_product_category_id" name="category_id" required>
                            @foreach (var category in ViewBag.Categories)
                            {
                                <option value="@category.category_id">@category.category_name</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Model Year</label>
                        <input type="number" class="form-control" id="edit_product_model_year" name="model_year" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">List Price</label>
                        <input type="number" step="0.01" class="form-control" id="edit_product_list_price" name="list_price" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Details Product Modal -->
<div class="modal fade" id="detailsProductModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Product Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="productDetailsContent"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Edit Staff
            $('.edit-staff').click(function () {
                var id = $(this).data('id');
                $.get('@Url.Action("GetStaff", "Maintain")/' + id, function (data) {
                    $('#edit_staff_id').val(data.staff_id);
                    $('#edit_staff_first_name').val(data.first_name);
                    $('#edit_staff_last_name').val(data.last_name);
                    $('#edit_staff_email').val(data.email);
                    $('#edit_staff_phone').val(data.phone);
                    $('#edit_staff_active').val(data.active);
                    $('#edit_staff_store_id').val(data.store_id);
                    $('#edit_staff_manager_id').val(data.manager_id || '');
                    $('#editStaffModal').modal('show');
                });
            });

            $('#editStaffForm').submit(function (e) {
                e.preventDefault();
                $.ajax({
                    url: '@Url.Action("EditStaff", "Maintain")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        if (response.success) {
                            alert('Staff updated successfully!');
                            location.reload();
                        } else {
                            alert('Failed to update staff.');
                        }
                    }
                });
            });

            // Details Staff
            $('.details-staff').click(function () {
                var id = $(this).data('id');
                $.get('@Url.Action("GetStaff", "Maintain")/' + id, function (data) {
                    var content = '<dl class="row">' +
                        '<dt class="col-sm-4">Name:</dt><dd class="col-sm-8">' + data.first_name + ' ' + data.last_name + '</dd>' +
                        '<dt class="col-sm-4">Email:</dt><dd class="col-sm-8">' + data.email + '</dd>' +
                        '<dt class="col-sm-4">Phone:</dt><dd class="col-sm-8">' + (data.phone || 'N/A') + '</dd>' +
                        '<dt class="col-sm-4">Active:</dt><dd class="col-sm-8">' + (data.active == 1 ? 'Yes' : 'No') + '</dd>' +
                        '</dl>';
                    $('#staffDetailsContent').html(content);
                    $('#detailsStaffModal').modal('show');
                });
            });

            // Delete Staff
            $('.delete-staff').click(function () {
                if (confirm('Are you sure you want to delete this staff member?')) {
                    var id = $(this).data('id');
                    $.ajax({
                        url: '@Url.Action("DeleteStaff", "Maintain")',
                        type: 'POST',
                        data: { id: id, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() },
                        success: function (response) {
                            if (response.success) {
                                alert('Staff deleted successfully!');
                                location.reload();
                            } else {
                                alert('Failed to delete staff.');
                            }
                        }
                    });
                }
            });

            // Edit Customer
            $('.edit-customer').click(function () {
                var id = $(this).data('id');
                $.get('@Url.Action("GetCustomer", "Maintain")/' + id, function (data) {
                    $('#edit_customer_id').val(data.customer_id);
                    $('#edit_customer_first_name').val(data.first_name);
                    $('#edit_customer_last_name').val(data.last_name);
                    $('#edit_customer_email').val(data.email);
                    $('#edit_customer_phone').val(data.phone);
                    $('#edit_customer_street').val(data.street);
                    $('#edit_customer_city').val(data.city);
                    $('#edit_customer_state').val(data.state);
                    $('#edit_customer_zip_code').val(data.zip_code);
                    $('#editCustomerModal').modal('show');
                });
            });

            $('#editCustomerForm').submit(function (e) {
                e.preventDefault();
                $.ajax({
                    url: '@Url.Action("EditCustomer", "Maintain")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        if (response.success) {
                            alert('Customer updated successfully!');
                            location.reload();
                        } else {
                            alert('Failed to update customer.');
                        }
                    }
                });
            });

            // Details Customer
            $('.details-customer').click(function () {
                var id = $(this).data('id');
                $.get('@Url.Action("GetCustomer", "Maintain")/' + id, function (data) {
                    var content = '<dl class="row">' +
                        '<dt class="col-sm-4">Name:</dt><dd class="col-sm-8">' + data.first_name + ' ' + data.last_name + '</dd>' +
                        '<dt class="col-sm-4">Email:</dt><dd class="col-sm-8">' + data.email + '</dd>' +
                        '<dt class="col-sm-4">Phone:</dt><dd class="col-sm-8">' + (data.phone || 'N/A') + '</dd>' +
                        '<dt class="col-sm-4">Address:</dt><dd class="col-sm-8">' + (data.street || '') + ', ' + (data.city || '') + ', ' + (data.state || '') + ' ' + (data.zip_code || '') + '</dd>' +
                        '</dl>';
                    $('#customerDetailsContent').html(content);
                    $('#detailsCustomerModal').modal('show');
                });
            });

            // Delete Customer
            $('.delete-customer').click(function () {
                if (confirm('Are you sure you want to delete this customer?')) {
                    var id = $(this).data('id');
                    $.ajax({
                        url: '@Url.Action("DeleteCustomer", "Maintain")',
                        type: 'POST',
                        data: { id: id, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() },
                        success: function (response) {
                            if (response.success) {
                                alert('Customer deleted successfully!');
                                location.reload();
                            } else {
                                alert('Failed to delete customer.');
                            }
                        }
                    });
                }
            });

            // Edit Product
            $('.edit-product').click(function () {
                var id = $(this).data('id');
                $.get('@Url.Action("GetProduct", "Maintain")/' + id, function (data) {
                    $('#edit_product_id').val(data.product_id);
                    $('#edit_product_name').val(data.product_name);
                    $('#edit_product_brand_id').val(data.brand_id);
                    $('#edit_product_category_id').val(data.category_id);
                    $('#edit_product_model_year').val(data.model_year);
                    $('#edit_product_list_price').val(data.list_price);
                    $('#editProductModal').modal('show');
                });
            });

            $('#editProductForm').submit(function (e) {
                e.preventDefault();
                $.ajax({
                    url: '@Url.Action("EditProduct", "Maintain")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        if (response.success) {
                            alert('Product updated successfully!');
                            location.reload();
                        } else {
                            alert('Failed to update product.');
                        }
                    }
                });
            });

            // Details Product
            $('.details-product').click(function () {
                var id = $(this).data('id');
                $.get('@Url.Action("GetProduct", "Maintain")/' + id, function (data) {
                    var content = '<dl class="row">' +
                        '<dt class="col-sm-4">Product Name:</dt><dd class="col-sm-8">' + data.product_name + '</dd>' +
                        '<dt class="col-sm-4">Model Year:</dt><dd class="col-sm-8">' + data.model_year + '</dd>' +
                        '<dt class="col-sm-4">List Price:</dt><dd class="col-sm-8">$' + data.list_price + '</dd>' +
                        '</dl>';
                    $('#productDetailsContent').html(content);
                    $('#detailsProductModal').modal('show');
                });
            });

            // Delete Product
            $('.delete-product').click(function () {
                if (confirm('Are you sure you want to delete this product?')) {
                    var id = $(this).data('id');
                    $.ajax({
                        url: '@Url.Action("DeleteProduct", "Maintain")',
                        type: 'POST',
                        data: { id: id, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() },
                        success: function (response) {
                            if (response.success) {
                                alert('Product deleted successfully!');
                                location.reload();
                            } else {
                                alert('Failed to delete product.');
                            }
                        }
                    });
                }
            });
        });
    </script>
    @Html.AntiForgeryToken()
}